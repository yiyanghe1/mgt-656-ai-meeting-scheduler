<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coffee Chatters A/B Test</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      // Page view with variant dimension
      gtag('config', 'G-XXXXXXXXXX', {
          'page_title': 'Coffee Chatters A/B Test',
          'page_path': window.location.pathname
      });
      // Custom event for A/B test view
      gtag('event', 'abtest_view', {
          'event_category': 'abtest',
          'event_label': '{{ variant }}',
          'variant': '{{ variant }}'
      });
    </script>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="mb-3">Team Member Nicknames</h1>
        <ul class="list-group mb-4">
            {% for n in nicknames %}
                <li class="list-group-item">{{ n }}</li>
            {% endfor %}
        </ul>
        <button id="abtest" class="btn btn-primary btn-lg" data-variant="{{ variant }}">{{ variant }}</button>
        <p class="mt-3 text-muted">
            Variant shown: <strong>{{ variant }}</strong>. This assignment is stored in your session and logged.
        </p>
    </div>
    <script>
        // CSRF helper
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
        const csrftoken = getCookie('csrftoken');

        document.getElementById('abtest').addEventListener('click', function () {
            const variant = this.getAttribute('data-variant');

            // GA event
            gtag('event', 'abtest_click', {
                'event_category': 'abtest',
                'event_label': variant,
                'variant': variant
            });

            // Server-side log
            fetch(window.location.pathname + 'track-click/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({clicked: true})
            }).catch(() => {});
        });
    </script>
</body>
</html>
